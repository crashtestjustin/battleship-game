(()=>{"use strict";const t=t=>({name:t,length:(()=>{switch(t){case"Carrier":return 5;case"Battleship":return 4;case"Destroyer":case"Submarine":return 3;case"Patrol Boat":return 2;default:return 0}})(),hitCount:0,sunk:!1,hit:function(){this.hitCount++,this.isSunk()},isSunk:function(){this.hitCount>=this.length&&(this.sunk=!0)}}),e=()=>({boardArray:[],missedGuesses:[],hitGuesses:[],shipsLeft:["Carrier","Battleship","Submarine","Destroyer","Patrol Boat"],shipsSunk:0,shipObjects:[],placeShipsRandom:function(){for(let e=0;e<this.shipsLeft.length;e++){let n=Math.random()>=.5,s=t(this.shipsLeft[e]),o=this.placeShipRecursive(s,n);this.boardArray.push(o),this.shipObjects.push(s),s.location=o}},placeShipRecursive:function(t,e){let s=n(),o=this.checkValidPlacement(t,s,e);return o?this.checkForShipOverlap(o)?this.placeShipRecursive(t,e):o:this.placeShipRecursive(t,e)},checkValidPlacement:function(t,e,n){let s=[];if(s.push(e),n&&e[0]+t.length>10)return!1;if(!n&&e[1]+t.length>10)return!1;for(let o=1;o<t.length;o++){let t;if(t=n?[e[0]+o,e[1]]:[e[0],e[1]+o],this.compareArrays(t))return!1;s.push(t)}return s},checkForShipOverlap:function(t){for(let e=0;e<this.shipObjects.length;e++){const n=this.shipObjects[e].location;for(let e=0;e<t.length;e++){const s=t[e];for(let t=0;t<n.length;t++){const e=n[t];if(e[0]===s[0]&&e[1]===s[1])return!0}}}return!1},compareArrays:function(t,e){let n=!1;if(void 0===e)for(let e=0;e<this.boardArray.length;e++){const s=this.boardArray[e];for(let e=0;e<s.length;e++)if(s[e][0]===t[0]&&s[e][1]===t[1]){n=!0;break}if(n)break}else for(let s=0;s<t.length;s++)if(t[s][0]===e[0]&&t[s][1]===e[1]){n=!0;break}return n},checkForAllSunk:function(){let t=0;for(let e=0;e<this.shipObjects.length;e++)this.shipObjects[e].sunk&&t++;return this.shipsSunk=t,t},receiveAttack:function(t){let e=null;for(let n=0;n<this.shipObjects.length;n++){const s=this.shipObjects[n].location;if(this.compareArrays(s,t)){if(this.shipObjects[n].hit(),this.hitGuesses.push(t),e=this.shipObjects[n],e.sunk){this.shipsLeft=[];for(let t=0;t<this.shipObjects.length;t++)this.shipObjects[t].sunk||this.shipsLeft.push(this.shipObjects[t].name)}break}}if(null!==e){const t=this.checkForAllSunk();return 5===t?t:e}return this.missedGuesses.push(t),t}});function n(){return[parseInt(10*Math.random()),parseInt(10*Math.random())]}const s=t=>({name:t,CPU:"CPU"===t,oponentGameboard:e(),attackHistory:[],checkAttackHist:function(t){let e=this.attackHistory;for(let n of e)if(n[0]===t[0]&&n[1]===t[1])return!0;return!1},submitAttack:function(t){if(void 0!==t&&this.checkAttackHist(t))return console.log("invalid guess"),"invalid guess";if(void 0===t){let e;do{e=n()}while(this.checkAttackHist(e));t=e}const e=this.oponentGameboard.receiveAttack(t);return this.attackHistory.push(t),e},announceAsWinner:function(){const t=`${this.name} has won the game!`;return console.log(t),t}});function o(t,e){const n=document.querySelectorAll(".all-p-ships"),s=document.querySelectorAll(".all-c-ships");if(void 0===t&&void 0===e)return n.forEach((t=>{t.style.textDecoration="none",t.style.opacity="1"})),void s.forEach((t=>{t.style.textDecoration="none",t.style.opacity="1"}));"CPU"===e?n.forEach((e=>{("final"===t||e.textContent===t.name)&&(e.style.textDecoration="line-through",e.style.opacity="0.25")})):s.forEach((e=>{("final"===t||e.textContent===t.name)&&(e.style.textDecoration="line-through",e.style.opacity="0.25")}))}function r(t,e){const n=document.createElement("div");return n.className=t,n.id=e,"undefined"===n.id&&(n.id=t),n}function i(t){const e=[];for(let t=0;t<10;t++)for(let n=0;n<10;n++){let s=[t,n];e.push(s)}return e[t]}!function(){const t=document.querySelector(".application"),e=function(){const t=r("header"),e=r("title");return e.textContent="Battleship Game",t.appendChild(e),t}();t.appendChild(e);const n=function(){const t=r("body"),e=r("body-title");e.textContent="Provide your name to start the game.";const n=r("game-inputs"),s=r("player-name-title");s.textContent="Your Name:";const o=function(t,e,n,s){const o=document.createElement("input");return o.type="text",o.id="name",o.placeholder="Enter your name captain!",o}(),a=function(t,e){const n=document.createElement("button");return n.className="start-game",n.textContent="Start Game",n}();n.append(s,o,a);const c=r("board-section"),l=r("board-titles");l.classList.add("p-board-titles");const h=r("player-board-title");h.textContent="Your Fleet",l.appendChild(h);const u=r("move-result");u.classList.add("p-move-result"),u.textContent="⛴️",l.appendChild(u);const d=r("board-div");d.classList.add("player-board");for(let t=0;t<100;t++){const e=r("grid-square",JSON.stringify(i(t)));e.classList.add("p-grid"),d.appendChild(e)}const p=r("board-titles");p.classList.add("c-board-titles");const f=r("cpu-board-title");f.textContent="Sink Enemy Ships!",p.appendChild(f);const m=r("move-result");m.classList.add("c-move-result"),m.textContent="⛴️",p.appendChild(m);const C=r("board-div");C.classList.add("cpu-board");for(let t=0;t<100;t++){const e=r("grid-square",JSON.stringify(i(t)));e.classList.add("c-grid"),C.appendChild(e)}c.append(l,d,p,C);const y=["Carrier","Battleship","Destroyer","Submarine","Patrol Boat"],b=r("ship-lists"),g=r("player-list"),k=r("ships-title");k.textContent="Your Ships Left";const S=r("p-ship-list");for(let t=0;t<y.length;t++){const e=r(`${y[t]}`);e.classList.add("all-p-ships"),e.textContent=`${y[t]}`,S.appendChild(e)}const v=r("cpu-list"),A=r("ships-title");A.textContent="CPU Ships Left";const x=r("c-ship-list");for(let t=0;t<y.length;t++){const e=r(`${y[t]}`);e.classList.add("all-c-ships"),e.textContent=`${y[t]}`,x.appendChild(e)}return g.append(k,S),v.append(A,x),b.append(g,v),t.appendChild(e),t.append(n,c,b),t}();t.appendChild(n);const s=function(){const t=r("footer"),e=r("title"),n=document.createElement("span");n.textContent="Created by ";const s=document.createElement("a");return s.href="https://github.com/crashtestjustin/battleship-game",s.textContent="Justin Elliott",e.append(n,s),t.appendChild(e),t}();t.appendChild(s)}(),function(){const t=document.querySelector(".body-title"),e=document.querySelector(".start-game"),n=document.querySelectorAll(".grid-square"),r=document.querySelectorAll(".p-grid"),i=document.querySelectorAll(".c-grid"),a=document.querySelector(".p-move-result"),c=document.querySelector(".c-move-result");let l,h,u,d=!0;function p(e){return t.textContent=`Awaiting ${u.name}'s attack.`,l=h.submitAttack(JSON.parse(e.target.id)),"invalid guess"===l?l:(5===l&&(e.target.style.backgroundColor="red",console.log("Game Over"),d=!1),Array.isArray(l)&&(e.target.style.backgroundColor="#b3b3cc",c.textContent="You Missed! ❌",console.log("MISS")),Array.isArray(l)||5===l||(e.target.style.backgroundColor="red",console.log(l),l.sunk?(c.textContent=`You sunk their ${l.name}!`,o(l,"user")):c.textContent="You hit a ship! 🫡"),d?void setTimeout((function(){if(l=u.submitAttack(),"invalid guess"===l)return l;if(5===l){let e=u.attackHistory.slice(-1);return r.forEach((t=>{let n=JSON.parse(t.id);n[0]===e[0][0]&&n[1]===e[0][1]&&(t.style.backgroundColor="red")})),console.log("Game Over"),t.textContent=u.announceAsWinner(),o("final","CPU"),a.textContent="(You = LOSER)",c.textContent="(CPU = WINNER!)",d=!1,void i.forEach((t=>{t.removeEventListener("click",p)}))}if(Array.isArray(l)&&(r.forEach((t=>{let e=JSON.parse(t.id);l[0]===e[0]&&l[1]===e[1]&&(t.style.backgroundColor="#b3b3cc")})),a.textContent="CPU Missed! ❌",console.log("MISS")),!Array.isArray(l)&&5!==l){let t=u.attackHistory.slice(-1);r.forEach((e=>{let n=JSON.parse(e.id);n[0]===t[0][0]&&n[1]===t[0][1]&&(e.style.backgroundColor="red")})),console.log(l),l.sunk?(a.textContent=`CPU has sunk your ${l.name}! 🥲🪦`,o(l,"CPU")):a.textContent="CPU has hit a ship! 😬"}t.textContent=`Awaiting ${h.name}'s attack.`}),500):(t.textContent=h.announceAsWinner(),o("final","user"),c.textContent="(CPU = LOSER)",a.textContent="(You = WINNER!)",void i.forEach((t=>{t.removeEventListener("click",p)}))))}e.addEventListener("click",(e=>{d=!0,n.forEach((t=>{t.style.backgroundColor="transparent"})),o(),h=s(document.querySelector("#name").value),u=s("CPU"),h.oponentGameboard.placeShipsRandom(),u.oponentGameboard.placeShipsRandom(),u.oponentGameboard.boardArray.forEach((t=>{t.forEach((t=>{for(let e=0;e<r.length;e++){const n=JSON.parse(r[e].id);t[0]===n[0]&&t[1]===n[1]&&(r[e].style.backgroundColor="#7faec9")}}))})),t.textContent=`Awaiting ${h.name}'s attack.`,i.forEach((t=>{t.removeEventListener("click",p)})),i.forEach((t=>{t.addEventListener("click",p)}))}))}()})();